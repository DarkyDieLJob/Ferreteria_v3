{% extends "pedido/base_pedido.html" %}

{% block encabezado %}
    <title>Pedidos</title>
    {% load static %}
{% endblock %}

{% block cuerpo %}
    <table>
        <thead>
            <tr>
                <th>Proveedor</th>
                <th>Pedido</th>
                <th>Faltantes</th>
            </tr>
        </thead>
        <tbody>
            {% for proveedor, pedidos in pedidos_activos.items %}
                <tr>
                    <td>{{ proveedor.text_display }}</td>
                    <td>
                        {% for pedido in pedidos %}

                            {% if pedido.get_estado_display == 'Pendiente'%}
                                <a href="{% url 'pedido:editar-pedido' pedido.id %}">{{ pedido }}</a><br>
                            {% elif pedido.get_estado_display == 'Enviado' %}
                                <a href="{% url 'pedido:detalle-pedido' pedido.id %}">{{ pedido }}</a><br>
                            {% else %}
                                <a href="{% url 'pedido:controlar-pedidos' pedido.id %}">{{ pedido }}</a><br>
                            {% endif %}

                        {% empty %}
                            {% if proveedor.pedido_set.count == 0 %}
                                Sin pedidos
                            {% else %}
                                No hay pedidos activos
                            {% endif %}
                        {% endfor %}
                        <a href="{% url 'pedido:nuevo-pedido' proveedor.id %}">Agregar pedido</a>
                    </td>
                    <td>
                        <a href="{% url 'pedido:listar-faltantes' proveedor.id %}">Ver articulos faltantes</a>
                    </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block script %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    
{% endblock %}